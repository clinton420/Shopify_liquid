{%- liquid
  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif
  
  assign product_form_id = 'product-form-' | append: product.id
  assign current_variant = product.selected_or_first_available_variant
  assign featured_media = product.featured_media
  assign quick_add = quick_add | default: false
-%}

<div class="product-card" data-product-id="{{ product.id }}">
  
  <div class="product-card-media">
    <a href="{{ product.url }}" class="product-link">
      {% if featured_media %}
        <img 
          src="{{ featured_media | image_url: width: 400 }}"
          srcset="{{ featured_media | image_url: width: 200 }} 200w,
                  {{ featured_media | image_url: width: 300 }} 300w,
                  {{ featured_media | image_url: width: 400 }} 400w"
          sizes="(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw"
          alt="{{ featured_media.alt | escape }}"
          loading="lazy"
          width="{{ featured_media.width }}"
          height="{{ featured_media.height }}"
          class="product-image"
        >
        
        {% comment %} Show second image on hover if available {% endcomment %}
        {% if product.media[1] %}
          <img 
            src="{{ product.media[1] | image_url: width: 400 }}"
            srcset="{{ product.media[1] | image_url: width: 200 }} 200w,
                    {{ product.media[1] | image_url: width: 300 }} 300w,
                    {{ product.media[1] | image_url: width: 400 }} 400w"
            sizes="(min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw"
            alt="{{ product.media[1].alt | escape }}"
            loading="lazy"
            width="{{ product.media[1].width }}"
            height="{{ product.media[1].height }}"
            class="product-image product-image--hover"
          >
        {% endif %}
      {% else %}
        {% render 'icon-placeholder' %}
      {% endif %}
    </a>

    {% if on_sale %}
      <div class="product-badge sale-badge">
        {{ 'products.product.on_sale' | t }}
      </div>
    {% endif %}

    {% if quick_add and current_variant.available %}
      <div class="quick-add">
        <product-form class="product-form">
          <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" id="{{ product_form_id }}">
            <input type="hidden" name="id" value="{{ current_variant.id }}">
            <button 
              type="submit" 
              name="add" 
              class="quick-add-button button button--small"
              {% unless current_variant.available %}disabled{% endunless %}
            >
              <span>{{ 'products.product.add_to_cart' | t }}</span>
              {% render 'icon-plus' %}
            </button>
          </form>
        </product-form>
      </div>
    {% endif %}

  </div>

  <div class="product-card-content">
    
    {% if product.vendor != blank %}
      <div class="product-vendor">{{ product.vendor }}</div>
    {% endif %}

    <h3 class="product-title">
      <a href="{{ product.url }}">{{ product.title | escape }}</a>
    </h3>

    <div class="product-price">
      <span class="price{% if on_sale %} price--on-sale{% endif %}">
        {{ current_variant.price | money }}
      </span>
      {% if on_sale %}
        <span class="price price--compare">
          {{ current_variant.compare_at_price | money }}
        </span>
      {% endif %}
    </div>

    {% comment %} Color swatches if available {% endcomment %}
    {% if product.options contains 'Color' or product.options contains 'Colour' %}
      <div class="product-colors">
        {% for variant in product.variants limit: 5 %}
          {% assign color_option = variant.option1 %}
          {% if product.options[1] == 'Color' or product.options[1] == 'Colour' %}
            {% assign color_option = variant.option2 %}
          {% elsif product.options[2] == 'Color' or product.options[2] == 'Colour' %}
            {% assign color_option = variant.option3 %}
          {% endif %}
          
          {% unless forloop.first %}
            <span 
              class="color-swatch" 
              style="background-color: {{ color_option | downcase | replace: ' ', '' }}"
              title="{{ color_option }}"
            ></span>
          {% endunless %}
        {% endfor %}
      </div>
    {% endif %}

  </div>

</div>