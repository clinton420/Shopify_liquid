{% comment %}
  JSON-LD Structured Data
{% endcomment %}

<!-- Organization Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  {% if settings.logo %}
    "logo": {{ settings.logo | image_url: width: 500 | prepend: "https:" | json }},
  {% endif %}
  {% if shop.description %}
    "description": {{ shop.description | json }},
  {% endif %}
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "email": {{ shop.email | json }}
  },
  "sameAs": [
    {% if settings.social_facebook_link != blank %}{{ settings.social_facebook_link | json }},{% endif %}
    {% if settings.social_twitter_link != blank %}{{ settings.social_twitter_link | json }},{% endif %}
    {% if settings.social_instagram_link != blank %}{{ settings.social_instagram_link | json }},{% endif %}
    {% if settings.social_tiktok_link != blank %}{{ settings.social_tiktok_link | json }},{% endif %}
    {% if settings.social_youtube_link != blank %}{{ settings.social_youtube_link | json }},{% endif %}
    {% if settings.social_pinterest_link != blank %}{{ settings.social_pinterest_link | json }}{% endif %}
  ]
}
</script>

<!-- Website Schema for homepage -->
{% if request.page_type == 'index' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": {{ shop.name | json }},
  "url": {{ shop.url | json }},
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "{{ shop.url }}/search?q={search_term_string}"
    },
    "query-input": "required name=search_term_string"
  }
}
</script>
{% endif %}

<!-- Product Schema -->
{% if template contains 'product' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ product.title | json }},
  "description": {{ product.description | strip_html | json }},
  "url": {{ shop.url | append: product.url | json }},
  {% if product.featured_media %}
    "image": [
      {{ product.featured_media | image_url: width: 1024 | prepend: "https:" | json }}
      {% for media in product.media offset: 1 limit: 9 %}
        ,{{ media | image_url: width: 1024 | prepend: "https:" | json }}
      {% endfor %}
    ],
  {% endif %}
  {% if product.variants.first.sku != blank %}
    "sku": {{ product.variants.first.sku | json }},
  {% endif %}
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  },
  {% if product.variants.first.barcode != blank %}
    "gtin": {{ product.variants.first.barcode | json }},
  {% endif %}
  "offers": [
    {% for variant in product.variants %}
      {
        "@type": "Offer",
        "name": {{ variant.title | json }},
        {% if variant.sku != blank %}
          "sku": {{ variant.sku | json }},
        {% endif %}
        "availability": "https://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
        "price": {{ variant.price | divided_by: 100.0 | json }},
        "priceCurrency": {{ cart.currency.iso_code | json }},
        "url": {{ shop.url | append: variant.url | json }}
        {% if variant.compare_at_price > variant.price %}
          ,"priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31"
        {% endif %}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
  {% if product.metafields.reviews.rating.value != blank %}
    ,"aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": {{ product.metafields.reviews.rating.value }},
      "reviewCount": {{ product.metafields.reviews.rating_count }}
    }
  {% endif %}
}
</script>
{% endif %}

<!-- Collection/Category Schema -->
{% if template contains 'collection' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": {{ collection.title | json }},
  {% if collection.description != blank %}
    "description": {{ collection.description | strip_html | json }},
  {% endif %}
  "url": {{ shop.url | append: collection.url | json }},
  {% if collection.image %}
    "image": {{ collection.image | image_url: width: 1024 | prepend: "https:" | json }},
  {% endif %}
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ collection.products_count }},
    "itemListElement": [
      {% for product in collection.products limit: 20 %}
        {
          "@type": "Product",
          "position": {{ forloop.index }},
          "name": {{ product.title | json }},
          "url": {{ shop.url | append: product.url | json }},
          {% if product.featured_media %}
            "image": {{ product.featured_media | image_url: width: 500 | prepend: "https:" | json }},
          {% endif %}
          "offers": {
            "@type": "Offer",
            "price": {{ product.price | divided_by: 100.0 | json }},
            "priceCurrency": {{ cart.currency.iso_code | json }},
            "availability": "https://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}"
          }
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}
</script>
{% endif %}

<!-- Breadcrumb Schema -->
{% unless template == 'index' %}
{%- liquid
  assign breadcrumb_links = ''
  assign breadcrumb_names = ''
  
  if template contains 'product'
    assign breadcrumb_links = routes.root_url | append: ',' | append: collection.url | append: ',' | append: product.url
    assign breadcrumb_names = 'Home,Collections,' | append: product.title
  elsif template contains 'collection'
    assign breadcrumb_links = routes.root_url | append: ',' | append: routes.collections_url | append: ',' | append: collection.url  
    assign breadcrumb_names = 'Home,Collections,' | append: collection.title
  elsif template contains 'page'
    assign breadcrumb_links = routes.root_url | append: ',' | append: page.url
    assign breadcrumb_names = 'Home,' | append: page.title
  endif
  
  assign breadcrumb_links_array = breadcrumb_links | split: ','
  assign breadcrumb_names_array = breadcrumb_names | split: ','
-%}

{% if breadcrumb_links_array.size > 1 %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {% for link in breadcrumb_links_array %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "name": {{ breadcrumb_names_array[forloop.index0] | json }},
        "item": {{ shop.url | append: link | json }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% endunless %}