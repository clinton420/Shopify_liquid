{{ 'section-header.css' | asset_url | stylesheet_tag }}

<header class="header" id="shopify-section-header">
  
  {% if section.settings.announcement_text != blank %}
    <div class="announcement-bar">
      <div class="page-width">
        <div class="announcement-content">
          {% if section.settings.announcement_link != blank %}
            <a href="{{ section.settings.announcement_link }}" class="announcement-link">
              {{ section.settings.announcement_text }}
            </a>
          {% else %}
            <span>{{ section.settings.announcement_text }}</span>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  <div class="header-wrapper">
    <div class="page-width">
      <div class="header-layout">
        
        <!-- Mobile Menu Toggle -->
        <button class="header-menu-toggle" aria-controls="mobile-menu" aria-expanded="false">
          <span class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>

        <!-- Logo -->
        <div class="header-logo">
          <a href="{{ routes.root_url }}" class="logo-link">
            {% if section.settings.logo != blank %}
              <img 
                src="{{ section.settings.logo | image_url: width: 300 }}"
                alt="{{ shop.name }}"
                loading="lazy"
                width="{{ section.settings.logo.width }}"
                height="{{ section.settings.logo.height }}"
                class="logo-image"
              >
            {% else %}
              <span class="logo-text">{{ shop.name }}</span>
            {% endif %}
          </a>
        </div>

        <!-- Desktop Navigation -->
        <nav class="header-nav desktop-only">
          <ul class="nav-list">
            {% for link in linklists[section.settings.main_menu].links %}
              <li class="nav-item {% if link.links != blank %}has-dropdown{% endif %}">
                <a href="{{ link.url }}" class="nav-link">
                  {{ link.title }}
                  {% if link.links != blank %}
                    {% render 'icon-chevron-down' %}
                  {% endif %}
                </a>
                
                {% if link.links != blank %}
                  <div class="mega-menu">
                    <div class="mega-menu-content">
                      <div class="mega-menu-columns">
                        {% for childlink in link.links %}
                          <div class="mega-menu-column">
                            <a href="{{ childlink.url }}" class="mega-menu-title">{{ childlink.title }}</a>
                            {% if childlink.links != blank %}
                              <ul class="mega-menu-links">
                                {% for grandchildlink in childlink.links %}
                                  <li>
                                    <a href="{{ grandchildlink.url }}">{{ grandchildlink.title }}</a>
                                  </li>
                                {% endfor %}
                              </ul>
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </nav>

        <!-- Header Actions -->
        <div class="header-actions">
          
          <!-- Search -->
          <div class="header-search">
            <button class="search-toggle" aria-controls="search-drawer" aria-expanded="false">
              {% render 'icon-search' %}
              <span class="visually-hidden">{{ 'general.search.search' | t }}</span>
            </button>
            
            <div class="search-drawer" id="search-drawer">
              <form action="{{ routes.search_url }}" method="get" class="search-form">
                <div class="search-input-wrapper">
                  <input 
                    type="search" 
                    name="q" 
                    placeholder="{{ 'general.search.placeholder' | t }}"
                    value="{{ search.terms | escape }}"
                    class="search-input"
                    autocomplete="off"
                  >
                  <button type="submit" class="search-submit">
                    {% render 'icon-search' %}
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Account -->
          <a href="{{ routes.account_url }}" class="header-account">
            {% render 'icon-account' %}
            <span class="visually-hidden">
              {% if customer %}
                {{ 'customer.account_fallback' | t }}
              {% else %}
                {{ 'customer.log_in' | t }}
              {% endif %}
            </span>
          </a>

          <!-- Cart -->
          <a href="{{ routes.cart_url }}" class="header-cart" id="cart-icon">
            {% render 'icon-cart' %}
            <span class="cart-count" id="cart-count">{{ cart.item_count }}</span>
            <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
          </a>

        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu-content">
      <div class="mobile-menu-header">
        <span class="mobile-menu-title">{{ 'general.navigation.menu' | t }}</span>
        <button class="mobile-menu-close">
          {% render 'icon-close' %}
        </button>
      </div>
      
      <nav class="mobile-nav">
        <ul class="mobile-nav-list">
          {% for link in linklists[section.settings.main_menu].links %}
            <li class="mobile-nav-item {% if link.links != blank %}has-children{% endif %}">
              <a href="{{ link.url }}" class="mobile-nav-link">
                {{ link.title }}
                {% if link.links != blank %}
                  {% render 'icon-chevron-right' %}
                {% endif %}
              </a>
              
              {% if link.links != blank %}
                <ul class="mobile-submenu">
                  {% for childlink in link.links %}
                    <li class="mobile-submenu-item">
                      <a href="{{ childlink.url }}" class="mobile-submenu-link">{{ childlink.title }}</a>
                      {% if childlink.links != blank %}
                        <ul class="mobile-sub-submenu">
                          {% for grandchildlink in childlink.links %}
                            <li>
                              <a href="{{ grandchildlink.url }}">{{ grandchildlink.title }}</a>
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>

      <div class="mobile-menu-footer">
        <a href="{{ routes.account_url }}" class="mobile-account-link">
          {% render 'icon-account' %}
          {% if customer %}
            {{ customer.first_name | default: 'Account' }}
          {% else %}
            {{ 'customer.log_in' | t }}
          {% endif %}
        </a>
      </div>
    </div>
  </div>

</header>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text",
      "default": "Free shipping on orders over $75"
    },
    {
      "type": "url",
      "id": "announcement_link",
      "label": "Announcement link"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 100,
      "max": 300,
      "step": 10,
      "default": 150,
      "unit": "px",
      "label": "Desktop logo width"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}